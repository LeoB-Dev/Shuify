<!DOCTYPE html>
<html>

<head>
    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #2a2a3a;
        }

        #iso {
            width: 60vmin;
            aspect-ratio: 1;
            background: #1a4d7a;
            position: relative;
            transform:
                rotate(90deg) skewX(-30deg) scaleY(0.864);
            transform-origin: center;
        }

        #tray {
            margin-top: 40px;
            width: 100%;
            height: 120px;
            background: #3a3a4a;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #card {
            position: absolute;
            width: 10vmin;
            aspect-ratio: 1;
            background: #AFDA9F;
            cursor: grab;
        }
    </style>
</head>

<body>
    <div id="iso"></div>
    <div id="tray">
        <div id="card"></div>
    </div>

    <script>
        const card = document.getElementById("card")
        const iso = document.getElementById("iso")
        const tray = document.getElementById("tray")

        let dragging = false, ox = 0, oy = 0

        // inverse isometric projection
        function screenToIso(px, py, rect) {
            const sx = px - (rect.left + rect.width / 2)
            const sy = py - (rect.top + rect.height / 2)

            const x = (sx / 0.866 + sy / 0.5) / 2
            const y = (sy / 0.5 - sx / 0.866) / 2
            return { x, y }
        }

        // diamond hit test in iso space
        function insideIso(px, py, rect) {
            const p = screenToIso(px, py, rect)
            return Math.abs(p.x) <= rect.width / 2 && Math.abs(p.y) <= rect.height / 2
        }

        card.onpointerdown = e => {
            const r = card.getBoundingClientRect()
            ox = e.clientX - r.left
            oy = e.clientY - r.top
            card.style.position = "fixed"
            card.style.left = r.left + "px"
            card.style.top = r.top + "px"
            dragging = true
            card.setPointerCapture(e.pointerId)
        }

        window.onpointermove = e => {
            if (!dragging) return
            card.style.left = (e.clientX - ox) + "px"
            card.style.top = (e.clientY - oy) + "px"
        }

        window.onpointerup = e => {
            if (!dragging) return
            dragging = false

            const dz = iso.getBoundingClientRect()
            const target = insideIso(e.clientX, e.clientY, dz) ? iso : tray
            target.appendChild(card)

            if (target === iso) {
                const p = screenToIso(e.clientX, e.clientY, dz)
                const x = (p.x / dz.width + 0.5) * 100
                const y = (p.y / dz.height + 0.5) * 100
                card.style.left = x + "%"
                card.style.top = y + "%"
            } else {
                card.style.left = "50%"
                card.style.top = "50%"
                card.style.transform = "translate(-50%,-50%)"
            }

            card.style.position = "absolute"
        }
    </script>
</body>

</html>